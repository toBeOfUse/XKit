{"id":"shuffle_queue","script":"//* TITLE Enhanced Queue **//\n//* VERSION 2.2.1 **//\n//* DESCRIPTION Additions to the Queue page. **//\n//* DEVELOPER STUDIOXENIX **//\n//* DETAILS Go to your queue and click on the Shuffle button on the sidebar to shuffle the posts. Note that only the posts you see will be shuffled. If you have more than 15 posts on your queue, scroll down and load more posts in order to shuffle them too. Or click on Shrink Posts button to quickly rearrange them. **//\n//* FRAME false **//\n//* BETA false **//\n\nXKit.extensions.shuffle_queue = new Object({\n\n\trunning: false,\n\n\trun: function() {\n\n\t\tif (!XKit.interface.where().queue) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.running = true;\n\n\t\tXKit.interface.sidebar.add({\n\t\t\tid: \"queue_plus_sidebar\",\n\t\t\ttitle: \"Queue+\",\n\t\t\titems: [\n\t\t\t\t{ id: \"xshufflequeue_button\", text: \"Shuffle Queue\" },\n\t\t\t\t{ id: \"xdeletequeue_button\", text: \"Clear Queue\" },\n\t\t\t\t{ id: \"xshrinkposts_button\", text: \"Shrink Posts\", count: \"off\" },\n\t\t\t\t{ id: \"xqueueoptions_button\", text: \"Queue Options\", count: \"on\" }\n\t\t\t]\n\t\t});\n\n\t\t$(\"#xshufflequeue_button\").click(() => this.shuffle());\n\t\t$(\"#xdeletequeue_button\").click(() => this.clear());\n\t\t$(\"#xshrinkposts_button\").click(function() {\n\t\t\tif (XKit.installed.is_running(\"shorten_posts\")) {\n\t\t\t\tXKit.window.show(\n\t\t\t\t\t\"Unable to turn on Shrink Posts\",\n\t\t\t\t\t\"Using the Shrink Posts option and Shorten Posts together creates a small mess that no one really wants to see. \" +\n\t\t\t\t\t\"If you still want to use the Shrink Posts functionality of Enhanced Queue, disable the Shorten Posts extension first.\",\n\n\t\t\t\t\t\"error\",\n\n\t\t\t\t\t'<div class=\"xkit-button default\" id=\"xkit-close-message\">OK</div>'\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tlet $button = $(this).toggleClass(\"xkit-queue-option-button-on\");\n\t\t\t\tif ($button.hasClass(\"xkit-queue-option-button-on\")) {\n\t\t\t\t\t$button.find(\".count\").html(\"on\");\n\t\t\t\t\tXKit.storage.set(\"shuffle_queue\", \"shrink_posts\", \"true\");\n\t\t\t\t\tXKit.tools.add_css(\n\t\t\t\t\t\t\".post_header { display: none; }\" +\n\t\t\t\t\t\t\".post .post_content_inner, .post .post_media { height: 70px !important; overflow: hidden !important; }\" +\n\t\t\t\t\t\t\".post .post_content { pointer-events: none !important; height: 70px !important; overflow: hidden !important; border: 1px dashed rgb(200,200,200); }\",\n\n\t\t\t\t\t\t\"shuffle_queue_mini_posts\"\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\t$button.find(\".count\").html(\"off\");\n\t\t\t\t\tXKit.storage.set(\"shuffle_queue\", \"shrink_posts\", \"false\");\n\t\t\t\t\tXKit.tools.remove_css(\"shuffle_queue_mini_posts\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t$(\"#xqueueoptions_button\").click(function() {\n\t\t\tlet $button = $(this).toggleClass(\"xkit-queue-option-button-on\");\n\n\t\t\tif ($button.hasClass(\"xkit-queue-option-button-on\")) {\n\t\t\t\t$button.find(\".count\").html(\"off\");\n\t\t\t\tXKit.storage.set(\"shuffle_queue\", \"hide_options\", \"true\");\n\t\t\t\tXKit.tools.add_css(\" .dashboard_options_form { display: none; }\", \"shuffle_queue_hide_options\");\n\t\t\t} else {\n\t\t\t\t$button.find(\".count\").html(\"on\");\n\t\t\t\tXKit.storage.set(\"shuffle_queue\", \"hide_options\", \"false\");\n\t\t\t\tXKit.tools.remove_css(\"shuffle_queue_hide_options\");\n\t\t\t}\n\t\t});\n\n\t\tvar shrink_posts = XKit.storage.get(\"shuffle_queue\", \"shrink_posts\", \"false\");\n\t\tif (shrink_posts === \"true\" || shrink_posts === true) {\n\t\t\t$(\"#xshrinkposts_button\").click();\n\t\t}\n\n\t\tvar hide_options = XKit.storage.get(\"shuffle_queue\", \"hide_options\", \"false\");\n\t\tif (hide_options === \"true\" || hide_options === true) {\n\t\t\t$(\"#xqueueoptions_button\").click();\n\t\t}\n\n\t},\n\n\tshuffle: function() {\n\n\t\tXKit.window.show(\n\t\t\t\"Shuffle Queue\",\n\t\t\t\"Would you like to shuffle your queue?<br>\" +\n\t\t\t\"Please note that only loaded posts can be shuffled. \" +\n\t\t\t\"To shuffle your entire queue, scroll down until your whole queue is loaded.\",\n\n\t\t\t\"question\",\n\n\t\t\t'<div id=\"xshufflequeue_confirm\" class=\"xkit-button default\">Shuffle!</div>' +\n\t\t\t'<div id=\"xkit-close-message\" class=\"xkit-button\">Cancel</div>'\n\t\t);\n\n\t\t$(\"#xshufflequeue_confirm\").click(() => {\n\t\t\tif ($(\"#xshufflequeue_confirm\").hasClass(\"disabled\")) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$(\"#xshufflequeue_confirm\")\n\t\t\t\t.addClass(\"disabled\")\n\t\t\t\t.text(\"Shuffling...\");\n\n\t\t\tlet postIDs = [];\n\t\t\t$(\"#posts [data-pageable]\").each(function() {\n\t\t\t\tlet [ /* \"post\" */, postID] = $(this).attr(\"data-pageable\").split(\"_\");\n\t\t\t\tpostIDs.push(postID);\n\t\t\t});\n\n\t\t\tif (postIDs.length === 0) {\n\t\t\t\tXKit.window.close();\n\t\t\t\tXKit.notifications.add(\"Didn't find any posts to shuffle!\", \"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// https://stackoverflow.com/a/12646864\n\t\t\tfor (let i = postIDs.length - 1; i > 0; i--) {\n\t\t\t\tconst j = Math.floor(Math.random() * (i + 1));\n\t\t\t\t[postIDs[i], postIDs[j]] = [postIDs[j], postIDs[i]];\n\t\t\t}\n\n\t\t\tlet blogname = XKit.interface.where().user_url;\n\n\t\t\tXKit.tools.Nx_XHR({\n\t\t\t\tmethod: \"POST\",\n\t\t\t\turl: `https://www.tumblr.com/blog/${blogname}/order_post_queue`,\n\t\t\t\theaders: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\tdata: $.param({\n\t\t\t\t\t\"form_key\": XKit.interface.form_key(),\n\t\t\t\t\t\"post_ids\": postIDs.join(\",\")\n\t\t\t\t}),\n\t\t\t\tonload: response => {\n\t\t\t\t\tpostIDs.reverse().forEach(postID => {\n\t\t\t\t\t\t$(\"#new_post_buttons\").after($(`[data-pageable=\"post_${postID}\"]`));\n\t\t\t\t\t});\n\t\t\t\t\tXKit.window.close();\n\t\t\t\t\tXKit.notifications.add(`Shuffled ${postIDs.length} posts!`, \"ok\");\n\t\t\t\t},\n\t\t\t\tonerror: response => {\n\t\t\t\t\tXKit.window.show(\n\t\t\t\t\t\t\"Unable to save queue.\",\n\t\t\t\t\t\t`Something went wrong: HTTP ${response.status}. Please try again later.`,\n\n\t\t\t\t\t\t\"error\",\n\n\t\t\t\t\t\t'<div id=\"xkit-close-message\" class=\"xkit-button default\">OK</div>'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tposts_to_delete: [],\n\tposts_to_delete_count: 0,\n\n\tclear: function() {\n\n\t\tXKit.window.show(\n\t\t\t\"Clear Queue?\",\n\t\t\t\"Delete all the posts in your queue?\",\n\n\t\t\t\"question\",\n\n\t\t\t'<div class=\"xkit-button default\" id=\"xkit-clear-queue-confirm\">Yes</div>' +\n\t\t\t'<div class=\"xkit-button\" id=\"xkit-close-message\">Cancel</div>'\n\t\t);\n\n\t\t$(\"#xkit-clear-queue-confirm\").click(() => {\n\n\t\t\tXKit.window.show(\n\t\t\t\t\"Please wait...\",\n\n\t\t\t\t'<span id=\"xkit-shuffle-queue-progress\">Please wait, gathering posts to delete...</span>' +\n\t\t\t\tXKit.progress.add(\"shuffle-queue-delete\"),\n\n\t\t\t\t\"info\"\n\t\t\t);\n\n\t\t\tthis.posts_to_delete = [];\n\t\t\tthis.posts_to_delete_count = 0;\n\t\t\tthis.clear_collect_next();\n\t\t});\n\n\t},\n\n\tclear_collect_next: function(page = 1) {\n\t\tconst username = XKit.interface.where().user_url;\n\n\t\tXKit.tools.Nx_XHR({\n\t\t\tmethod: \"GET\",\n\t\t\turl: `https://www.tumblr.com/blog/${username}/queue?page=${page}`\n\t\t}).then(response => {\n\t\t\tif ($(\".no_posts_found\", response.responseText).length) {\n\t\t\t\t$(\"#xkit-shuffle-queue-progress\")\n\t\t\t\t\t.text(`Mass-deleting ${this.posts_to_delete.length} posts...`);\n\t\t\t\tthis.posts_to_delete_count = this.posts_to_delete.length;\n\t\t\t\tthis.clear_delete_next();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$(\"#posts .post\", response.responseText).each((i, post) => {\n\t\t\t\tconst $post = $(post);\n\t\t\t\tconst post_id = $post.attr(\"data-post-id\");\n\t\t\t\tthis.posts_to_delete.push(post_id);\n\t\t\t});\n\n\t\t\t$(\"#xkit-shuffle-queue-progress\")\n\t\t\t\t.text(`Please wait, gathering posts to delete... (${this.posts_to_delete.length} so far...)`);\n\n\t\t\tthis.clear_collect_next(page + 1);\n\t\t}).catch(response =>\n\t\t\tthis.clear_error(\"Couldn't gather posts to delete.\", response.status)\n\t\t);\n\t},\n\n\tclear_delete_next: function() {\n\t\tif (this.posts_to_delete.length === 0) {\n\t\t\tthis.clear_done();\n\t\t\treturn;\n\t\t}\n\n\t\tXKit.interface.mass_edit(this.posts_to_delete.splice(0, 100), {\"mode\": \"delete\"})\n\t\t.then(() => {\n\t\t\tconst done = this.posts_to_delete_count - this.posts_to_delete.length;\n\t\t\tconst percent = Math.round((done * 100) / this.posts_to_delete_count);\n\t\t\tXKit.progress.value(\"shuffle-queue-delete\", percent);\n\n\t\t\tthis.clear_delete_next();\n\t\t}).catch(response =>\n\t\t\tthis.clear_error(\"Couldn't mass-delete posts.\", response.status)\n\t\t);\n\t},\n\n\tclear_done: function() {\n\t\tXKit.window.show(\n\t\t\t\"Done!\",\n\n\t\t\t`Queue+ deleted ${this.posts_to_delete_count} posts from your queue.`,\n\n\t\t\t\"info\",\n\n\t\t\t'<div id=\"xkit-queue-refresh\" class=\"xkit-button default\">Refresh</div>'\n\t\t);\n\n\t\t$(\"#xkit-queue-refresh\").click(() => location.reload(true));\n\t},\n\n\tclear_error: (message, status) => XKit.window.show(\n\t\t\t\"Unable to clear queue.\",\n\n\t\t\t`${message}<br>\n\t\t\tThe server responded with HTTP ${status}.<br>\n\t\t\tPlease try again later, or file a bug report if this keeps occurring.`,\n\n\t\t\t\"error\",\n\n\t\t\t'<div class=\"xkit-button default\" id=\"xkit-close-message\">OK</div>' +\n\t\t\t'<a href=\"https://new-xkit-support.tumblr.com/\" target=\"_blank\" class=\"xkit-button\">New XKit support</a>'\n\t),\n\n\tdestroy: function() {\n\t\tXKit.tools.remove_css(\"shuffle_queue_mini_posts\");\n\t\tXKit.tools.remove_css(\"shuffle_queue_hide_options\");\n\t\tXKit.interface.sidebar.remove(\"queue_plus_sidebar\");\n\t\tthis.running = false;\n\t}\n\n});\n","file":"found","server":"up","errors":false,"icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGNzdGMTE3NDA3MjA2ODExODA4MzkyMjM2MzU5MTQ4NCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo2Q0Y3QkY5NTgyMDYxMUUzQjI4QzgxNzhBMDBERDcwMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2Q0Y3QkY5NDgyMDYxMUUzQjI4QzgxNzhBMDBERDcwMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAyODAxMTc0MDcyMDY4MTE4QkRBRjU5ODYxRUUyRjREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY3N0YxMTc0MDcyMDY4MTE4MDgzOTIyMzYzNTkxNDg0Ii8+IDwvcmRmOkRlc2NyaXB0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","title":"Enhanced Queue","description":"Additions to the Queue page.","developer":"STUDIOXENIX","version":"2.2.1","details":"Go to your queue and click on the Shuffle button on the sidebar to shuffle the posts. Note that only the posts you see will be shuffled. If you have more than 15 posts on your queue, scroll down and load more posts in order to shuffle them too. Or click on Shrink Posts button to quickly rearrange them.","frame":"false","beta":"false","slow":"false"}